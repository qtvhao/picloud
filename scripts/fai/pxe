#!/bin/bash
set -e
args=("$@")
ISO_FILE=${args[0]}
if [ -z "$ISO_FILE" ]; then
    echo "ISO_FILE is empty"
    exit 1
fi
echo "ISO_FILE: $ISO_FILE"
echo "Provisioning on metal machine"
make -v > /dev/null 2>&1 || \
    apt install -y make
ansible-playbook --version > /dev/null 2>&1 || \
    apt install -y ansible
pip3 > /dev/null 2>&1 \
    || apt install -y python3-pip
python --version > /dev/null 2>&1 \
    || apt install -y python
python3 --version || apt install -y python3
xorriso -version > /dev/null 2>&1 || apt install -y xorriso
pip install docker==4.4.4
pip install docker-compose
pip install ansible
cp $ISO_FILE ./metal/roles/pxe_server/files/data/iso/image.iso
make -C metal
